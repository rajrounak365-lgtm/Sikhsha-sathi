{% extends "layout.html" %}
{% block title %}Course Performance | Shiksha Sathi{% endblock %}

{% block content %}
 <!-- Back Button -->
  <a href="/reports"
     class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
     ‚¨Ö Back
  </a>
<div class="p-6 min-h-screen bg-gray-50">
  <h1 class="text-3xl font-bold mb-4">üèÜ Course Performance</h1>
  <p class="text-gray-500 mb-6">Top 3 students per test (filter by course & month)</p>

  <!-- Filter Form -->
  <form method="GET" class="mb-6 flex gap-4">
    <select name="course_id" class="border rounded px-3 py-2">
      <option value="">All Courses</option>
      {% for course in courses %}
        <option value="{{ course._id }}" {% if course_id_filter and course._id|string == course_id_filter %}selected{% endif %}>
          {{ course.name }}
        </option>
      {% endfor %}
    </select>
    <select name="subject" class="border rounded px-3 py-2">
  <option value="">All Subjects</option>
  {% for sub in subjects %}
    <option value="{{ sub }}" {% if subject_filter == sub %}selected{% endif %}>{{ sub }}</option>
  {% endfor %}
</select>



    <select name="month" class="border rounded px-3 py-2">
      <option value="">All Months</option>
      {% for m in range(1,13) %}
        <option value="{{ m }}" {% if month_filter and m == month_filter %}selected{% endif %}>{{ m }}</option>
      {% endfor %}
    </select>

    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Filter</button>
  </form>

  <!-- Results -->
  <div class="space-y-4">
    {% if filter_top_performers %}
      {% for performer in filter_top_performers %}
      <div class="bg-white shadow-md rounded-lg p-4 flex justify-between items-center">
        <div>
          <span class="text-lg font-bold text-blue-700">{{ performer.student_name }}</span>
          <span class="block text-gray-500 text-sm">{{ performer.course_name }}</span>
          <span class="block text-gray-600 text-sm">Test: {{ performer.test_title }}</span>
          <span class="block text-gray-400 text-xs">Date: {{ performer.scheduled_date.strftime('%d %b %Y') }}</span>
        </div>
        <div class="text-right">
          <span class="text-purple-600 font-semibold text-xl">{{ performer.percentage }}%</span>
          <span class="block text-gray-500 text-sm">Score: {{ performer.marks_obtained }} / {{ performer.total_marks }}</span>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <p class="text-gray-500">No performers found for selected filters.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
