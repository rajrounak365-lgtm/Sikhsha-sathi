{% extends "layout.html" %}
{% block title %}Material Detail | Sikhsha Sathi{% endblock %}

{% block content %}
<div class="mb-6">
  <h1 class="text-3xl font-bold">üìñ {{ material.title }}</h1>
  <p class="text-gray-600">Subject: {{ material.subject }}</p>
  <p class="text-gray-500">Course: {{ material.course_name }}</p>
  <p class="text-gray-500 mt-2">Uploaded by: {{ material.uploaded_by }}</p>
  <p class="text-gray-500 mt-2">Type: {{ material.material_type }}</p>
  <p class="text-gray-500 mt-2">Tags: {% for t in material.tags %}{{ t }} {% endfor %}</p>
  <p class="text-gray-500 mt-2">Description: {{ material.description }}</p>
  <p class="text-gray-500 mt-2">Uploaded on: {{ material.created_at.strftime('%d/%m/%Y') if material.created_at }}</p>
  <p class="text-gray-500 mt-2">Downloads: {{ material.downloads }}</p>

  {% if material.files %}
    <div class="mt-2">
      <h3 class="font-semibold">Files:</h3>
      <ul class="list-disc list-inside">
        {% for f in material.files %}
          <li>
            <a href="/material/download/{{ material._id }}" class="text-orange-600 hover:underline">{{ f.file_name }}</a>
            ({{ (f.file_size / 1024 / 1024)|round(2) }} MB)
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
</div>

<!-- Action Buttons -->
<div class="flex gap-3 mb-6">
  <button id="editBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg">‚úèÔ∏è Edit</button>
  <form method="post" action="/material/delete/{{ material._id }}" onsubmit="return confirm('Are you sure you want to delete this material?');">
    <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded-lg">üóëÔ∏è Delete</button>
  </form>
  <a href="/materials" class="px-4 py-2 bg-gray-200 rounded-lg">‚¨Ö Back</a>
</div>
<!-- Edit Form (hidden by default) -->
<div id="editForm" class="hidden bg-white p-4 rounded-lg shadow-md mb-6">
  <h2 class="text-xl font-bold mb-4">‚úèÔ∏è Edit Material</h2>
  <form method="post" action="/material/update/{{ material._id }}" enctype="multipart/form-data" class="space-y-3">
    <input type="text" name="title" value="{{ material.title }}" class="w-full border px-3 py-2 rounded-lg" required>
    <input type="text" name="subject" value="{{ material.subject }}" class="w-full border px-3 py-2 rounded-lg" required>

    <select name="material_type" class="w-full border px-3 py-2 rounded-lg" required>
      <option value="Notes" {% if material.material_type=="Notes" %}selected{% endif %}>Notes</option>
      <option value="Practice Set" {% if material.material_type=="Practice Set" %}selected{% endif %}>Practice Set</option>
      <option value="Video" {% if material.material_type=="Video" %}selected{% endif %}>Video</option>
    </select>

    <select name="course" class="w-full border px-3 py-2 rounded-lg" required>
      {% for c in courses %}
        <option value="{{ c._id }}" {% if material.course_id == c._id|string %}selected{% endif %}>
          {{ c.name }}
        </option>
      {% endfor %}
    </select>

    <input type="text" value="{{ material.uploaded_by }}" class="w-full border px-3 py-2 rounded-lg bg-gray-100" readonly>

    <input type="text" name="tags" value="{{ material.tags | join(', ') }}" class="w-full border px-3 py-2 rounded-lg">
    <textarea name="description" class="w-full border px-3 py-2 rounded-lg">{{ material.description }}</textarea>

    <!-- Existing Files with Remove Option -->
    {% if material.files %}
      <div class="mb-2">
        <h3 class="font-semibold">Existing Files:</h3>
        <ul class="list-disc list-inside">
          {% for f in material.files %}
            <li>
              <input type="checkbox" name="remove_files" value="{{ f.file_name }}" class="mr-2">
              <a href="/material/download/{{ material._id }}?file={{ f.file_name }}" class="text-orange-600 hover:underline">{{ f.file_name }}</a>
              ({{ (f.file_size / 1024 / 1024)|round(2) }} MB) ‚Äì Check to remove
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <!-- Optional New Files Upload -->
    <input type="file" name="files" multiple class="w-full">
    <p class="text-gray-500 text-sm">Leave empty if you don't want to upload new files.</p>

    <div class="flex justify-end gap-3">
      <button type="button" id="cancelEdit" class="px-4 py-2 bg-gray-200 rounded-lg">Cancel</button>
      <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-lg">Update</button>
    </div>
  </form>
</div>



<script>
  const editBtn = document.getElementById('editBtn');
  const editForm = document.getElementById('editForm');
  const cancelEdit = document.getElementById('cancelEdit');

  editBtn.addEventListener('click', () => {
    editForm.classList.remove('hidden');
    editBtn.classList.add('hidden');
  });

  cancelEdit.addEventListener('click', () => {
    editForm.classList.add('hidden');
    editBtn.classList.remove('hidden');
  });
</script>
{% endblock %}
