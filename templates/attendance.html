{% extends "layout.html" %}

{% block title %}Attendance | Sikhsha Sathi{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold flex items-center gap-2">ğŸ“ Attendance</h1>
    <a href="/attendance/history" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">ğŸ“œ View All History</a>
</div>

<!-- Filters -->
<form method="get" action="/attendance" class="flex gap-4 mb-6 items-end">
    <div>
        <label class="block text-sm font-medium mb-1">Course</label>
        <select name="course_id" class="border px-3 py-2 rounded-lg">
            <option value="">Select Course</option>
            {% for c in courses %}
                <option value="{{ c._id }}" {% if selected_course == c._id|string %}selected{% endif %}>{{ c.name }}</option>
            {% endfor %}
        </select>
    </div>

    <div>
        <label class="block text-sm font-medium mb-1">Date</label>
        <input type="date" name="date" value="{{ selected_date or "" }}" class="border px-3 py-2 rounded-lg">
    </div>

    <button type="submit" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">Fetch Students</button>
</form>

{% if request.query_params.get('success') == '1' %}
<div class="mb-4 p-3 bg-green-100 text-green-800 rounded-lg">
    âœ… Attendance saved successfully!
</div>
{% endif %}

{% if students %}
<div id="attendanceTable" {% if request.query_params.get('success') == '1' %}style="display:none"{% endif %}>
    <form method="post" action="/attendance/add">
        <input type="hidden" name="course_id" value="{{ selected_course }}">
        <input type="hidden" name="date" value="{{ selected_date }}">

        <div class="overflow-x-auto">
            <table class="min-w-full bg-white border rounded-lg">
                <thead>
                    <tr class="bg-gray-100">
                        <th class="px-4 py-2 border">#</th>
                        <th class="px-4 py-2 border">Student Name</th>
                        <th class="px-4 py-2 border">Student Email</th>
                        <th class="px-4 py-2 border">Phone</th>
                        <th class="px-4 py-2 border text-center">Present</th>
                        <th class="px-4 py-2 border text-center">Absent</th>
                    </tr>
                </thead>
                <tbody>
                   {% for student in students %}
                   <tr>
                        <td class="px-4 py-2 border">{{ loop.index }}</td>
                        <td class="px-4 py-2 border">{{ student.name }}</td>
                       <td class="px-4 py-2 border">{{ student.student_email }}</td>
                       <td class="px-4 py-2 border">{{ student.phone }}</td>
                        <td class="px-4 py-2 border text-center">
                            <input type="radio" name="status_{{ student._id }}" value="present" required>
                        </td>
                        <td class="px-4 py-2 border text-center">
                            <input type="radio" name="status_{{ student._id }}" value="absent" required>
                        </td>
                    </tr>
                   {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="mt-4 flex justify-end gap-2">
            <button type="submit" class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-semibold">
                Submit Attendance
            </button>
            <a href="/attendance/history?course_id={{ selected_course }}&date={{ selected_date }}"
            class="px-6 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">ğŸ“œ View History</a>
        </div>
    </form>
</div>
{% endif %}
{% endblock %}
