{% extends "layout.html" %}
{% block title %}Institute Dashboard{% endblock %}

{% block content %}
<div class="bg-gray-50 min-h-screen p-6">

  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-800">📊 Institute Dashboard</h1>
      <p class="text-gray-600">Welcome back, At {{ institute["institute_name"]}}</p>
      <p class="text-gray-500 mt-1">
        Here's what's happening at your coaching institute today.
      </p>
    </div>
    <div class="flex gap-3">
      <a href="/event/add"
         class="bg-orange-600 hover:bg-orange-700 text-white px-5 py-2 rounded-lg shadow">
        ➕ Add Event
      </a>
      <a href="/tests"
         class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg shadow">
        📝 Scheduled Tests
      </a>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
    <div class="bg-white shadow rounded-xl p-6 text-center">
      <h2 class="text-2xl font-bold text-gray-800">{{ total_students }}</h2>
      <p class="text-gray-500">Active Students</p>
    </div>
    <div class="bg-white shadow rounded-xl p-6 text-center">
      <h2 class="text-2xl font-bold text-gray-800">{{ active_faculty }}</h2>
      <p class="text-gray-500">Active Faculty</p>
    </div>
    <div class="bg-white shadow rounded-xl p-6 text-center">
      <h2 class="text-2xl font-bold text-gray-800">{{ running_courses }}</h2>
      <p class="text-gray-500">Running Courses</p>
    </div>
    <div class="bg-white shadow rounded-xl p-6 text-center">
      <h2 class="text-2xl font-bold text-gray-800">₹ {{ monthly_revenue }}</h2>
      <p class="text-gray-500">This Month Revenue</p>
    </div>
  </div>

<!-- Two Column Layout -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

  <!-- Left Column: Recent Activities -->
  <div class="bg-white shadow rounded-xl p-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">🕒 Recent Activities</h2>
    <ul class="space-y-3">
      {% for activity in recent_activities %}
      <li class="border-b pb-2">
        <p class="text-gray-700 font-medium">
          {% if activity.get("name") %}
            👤 New student {{ activity["name"] }} enrolled in {{ activity["course_name"] }} Batch
          {% elif activity.get("amount") %}
            💲 Fee Payment of ₹{{ activity["amount"] }} received from
            {% for student in students_list %}
              {% if student["_id"]|string == activity["student_id"]|string %}
                {{ student["name"] }}
              {% endif %}
            {% endfor %}
          {% elif activity.get("test_type") %}
            📝 Test scheduled: {{ activity["title"] }} on {{ activity["scheduled_date"] }}
          {% elif activity.get("material_type") %}
            📚 New material uploaded: {{ activity["title"] }}
          {% else %}
            📌 Activity recorded
          {% endif %}
        </p>
        <p class="text-xs text-gray-500">
          {% set dt = activity.get("created_at") or activity.get("joined_date") or activity.get("date") or activity.get("scheduled_date") %}
          {{ dt[:10] if dt is string else dt.strftime("%Y-%m-%d") }}
        </p>
      </li>
      {% endfor %}
    </ul>
  </div>

  <!-- Right Column -->
  <div class="space-y-6">

    <!-- Upcoming Events Card -->
    <div class="bg-white shadow rounded-xl p-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">📅 Upcoming Events</h2>
      <ul class="space-y-3">
        {% for event in upcoming_events %}
        <li class="border-l-4 border-orange-600 pl-3">
          <p class="font-medium text-gray-800">{{ event["title"] }}</p>
          <p class="text-sm text-gray-500">
            {{ event["date"].strftime("%d %B %Y") }} at {{ event["time"] }}
          </p>
          <p class="text-xs text-gray-400">{{ event["audience"] }} | {{ event["type"] }}</p>
        </li>
        {% else %}
        <p class="text-gray-500">No upcoming events.</p>
        {% endfor %}
      </ul>
      <div class="mt-4 text-right">
        <a href="/events" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow">
          View All Events
        </a>
      </div>
    </div>

    <!-- Quick Actions Card (Separate, below Upcoming Events) -->
    <div class="bg-white shadow rounded-xl p-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">⚡ Quick Actions</h2>
      <div class="space-y-3">
        <a href="/students" class="flex items-center px-4 py-2 border rounded-lg hover:bg-gray-100">
          👥 <span class="ml-3">Add New Student</span>
        </a>
        <a href="/course" class="flex items-center px-4 py-2 border rounded-lg hover:bg-gray-100">
          📚 <span class="ml-3">Create Course</span>
        </a>
        <a href="/materials" class="flex items-center px-4 py-2 border rounded-lg hover:bg-gray-100">
          📄 <span class="ml-3">Upload Material</span>
        </a>
        <a href="/fees" class="flex items-center px-4 py-2 border rounded-lg hover:bg-gray-100">
          💲 <span class="ml-3">Fee Collection</span>
        </a>
      </div>
    </div>

  </div>
</div>


</div>
{% endblock %}
